<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Главная</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">

    <!-- Виджет 1: Топ-5 популярных товаров -->
    <section class="mb-5">
        <h2>Топ-5 популярных товаров</h2>
        <div class="list-group">
            {% for product in popular_products %}
            <div class="list-group-item d-flex align-items-center">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" width="60" class="me-3">
                {% endif %}
                <div>
                    <h5>{{ product.name }}</h5>
                    <p>Цена: {{ product.price }} ₽</p>
                    <p>Продано: {{ product.sold_quantity }}</p>
                    <a href="{% url 'shop:product_detail' product.id %}" class="btn btn-primary btn-sm">Подробнее</a>
                </div>
            </div>
            {% empty %}
            <p>Нет популярных товаров</p>
            {% endfor %}
        </div>
    </section>

    <!-- Виджет 2: Новые категории товаров -->
    <section class="mb-5">
        <h2>Новые категории</h2>
        <ul class="list-group">
            {% for category in new_categories %}
            <li class="list-group-item">
                <h5>{{ category.name }}</h5>
                <p>{{ category.description|truncatewords:15 }}</p>
            </li>
            {% empty %}
            <li class="list-group-item">Нет новых категорий</li>
            {% endfor %}
        </ul>
        <a href="{% url 'shop:category_list' %}">Все категории</a>
    </section>

    <!-- Виджет 3: Последние заказы -->
    <section class="mb-5">
        <h2>Последние заказы</h2>
        <ul class="list-group">
            {% for order in latest_orders %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ order.client.name }}</strong><br>
                    {{ order.date_ordered|date:"d.m.Y H:i" }}<br>
                    Статус: {{ order.status }}
                </div>
                <a href="{% url 'shop:order_detail' order.id %}" class="btn btn-outline-primary btn-sm">Просмотреть заказ</a>
            </li>
            {% empty %}
            <li class="list-group-item">Нет заказов</li>
            {% endfor %}
        </ul>
    </section>

    <!-- Виджет 4: Поиск товаров -->
    <section>
        <h2>Поиск товаров</h2>
        <form method="get" action="{% url 'shop:product_search' %}" class="row g-3">
            <div class="col-md-6">
                <input type="text" name="query" class="form-control" placeholder="Название товара">
            </div>
            <div class="col-md-4">
                <select name="category" class="form-select">
                    <option value="">Все категории</option>
                    {% for category in all_categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Найти</button>
            </div>
        </form>
    </section>

</div>
</body>
</html>
